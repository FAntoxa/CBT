<div class="diary-container">
  <div class="diary-header">
    <h1>–î–Ω–µ–≤–Ω–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</h1>
    <div class="header-controls">
      <input 
        type="date" 
        [value]="currentDate" 
        (change)="onDateChange($event)"
        class="date-picker"
      >
      <button (click)="onShowStats()" class="stats-button">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
      <button (click)="logout()" class="logout-button">–í—ã–π—Ç–∏</button>
    </div>
  </div>

  <div class="diary-content">
    <div class="navigation-buttons">
      <button (click)="loadPreviousEntry()" class="nav-button">
        ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è –∑–∞–ø–∏—Å—å
      </button>
      <button (click)="loadNextEntry()" class="nav-button">
        –°–ª–µ–¥—É—é—â–∞—è –∑–∞–ø–∏—Å—å ‚Üí
      </button>
    </div>

    <div *ngIf="loading" class="loading">
      –ó–∞–≥—Ä—É–∑–∫–∞...
    </div>

    <div *ngIf="!loading" class="diary-form">
      <div *ngIf="!canEdit" class="read-only-notice">
        <div class="notice-icon">üìù</div>
        <div class="notice-text">
          <strong>–ó–∞–ø–∏—Å—å –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞</strong><br>
          –ú–æ–∂–Ω–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å, –Ω–æ –Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </div>
      </div>

      <form [formGroup]="diaryForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="mood">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ:</label>
          <select 
            id="mood" 
            formControlName="mood" 
            class="form-control"
            [disabled]="!canEdit"
          >
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</option>
            <option *ngFor="let mood of moods" [value]="mood.value">
              {{ mood.displayName }}
            </option>
          </select>
          <div *ngIf="diaryForm.get('mood')?.invalid && diaryForm.get('mood')?.touched" class="error-message">
            –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
          </div>
        </div>

        <div class="form-group">
          <label for="thought">–ó–∞–ø–∏—Å–∏ –¥–Ω—è:</label>
          <textarea 
            id="thought" 
            formControlName="thought" 
            placeholder="–û–ø–∏—à–∏—Ç–µ —Å–≤–æ–∏ –º—ã—Å–ª–∏ –∏ —Å–æ–±—ã—Ç–∏—è –¥–Ω—è..."
            class="form-control"
            rows="6"
            [disabled]="!canEdit"
          ></textarea>
          <div *ngIf="diaryForm.get('thought')?.invalid && diaryForm.get('thought')?.touched" class="error-message">
            –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø–∏—Å–∏ –¥–Ω—è
          </div>
        </div>

        <div *ngIf="errorMessage" class="error-message">
          {{ errorMessage }}
        </div>

        <button 
          type="submit" 
          [disabled]="diaryForm.invalid || saving || !canEdit"
          class="save-button"
        >
          {{ saving ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : (canEdit ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–ó–∞–ø–∏—Å—å —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞') }}
        </button>
      </form>
    </div>

    <div *ngIf="textAnalysis && textAnalysis.negativeCount > 0" class="analysis-section">
      <h3>–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞:</h3>
      <div class="negative-count">
        –ù–∞–π–¥–µ–Ω–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Å–ª–æ–≤: <strong>{{ textAnalysis.negativeCount }}</strong>
      </div>
      <div class="highlighted-text" [innerHTML]="textAnalysis.highlightedText"></div>
    </div>

    <div *ngIf="textAnalysis && textAnalysis.negativeCount === 0 && textAnalysis.originalText" class="analysis-section positive">
      <h3>–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞:</h3>
      <div class="negative-count positive">
        ‚úÖ –ù–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Å–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
      </div>
    </div>
  </div>
</div> 